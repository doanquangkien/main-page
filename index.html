<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhật Ký Giao Dịch Chuyên Nghiệp</title>
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Thư viện Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Thư viện Moment.js (Để xử lý ngày tháng) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <!-- Thư viện XLSX (Để xuất/nhập Excel) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Thư viện Chart.js (Để vẽ biểu đồ) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!-- Favicon (Giữ nguyên) -->
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180"
        href="https://res.cloudinary.com/dvouakaon/image/upload/v1734032893/apple-touch-icon_fpnc8i.png">
    <link rel="icon" type="image/png" sizes="192x192"
        href="https://res.cloudinary.com/dvouakaon/image/upload/v1734032893/android-chrome-192x192_v5akgc.png">
    <link rel="icon" type="image/png" sizes="512x512"
        href="https://res.cloudinary.com/dvouakaon/image/upload/v1734032893/android-chrome-512x512_b8bzja.png">
    <link rel="icon" type="image/png" sizes="32x32"
        href="https://res.cloudinary.com/dvouakaon/image/upload/v1734032893/favicon-32x32_pn3fl5.png">
    <link rel="icon" type="image/png" sizes="16x16"
        href="https://res.cloudinary.com/dvouakaon/image/upload/v1734032892/favicon-16x16_kfbdd3.png">
</head>

<body>
    <header>
        <h1><i class="fas fa-chart-line"></i> Nhật Ký Giao Dịch</h1>
        <!-- Dùng để hiển thị Toast Message -->
        <div id="statusMessage" class="card"></div> 
    </header>

    <div class="container">
        <!-- FORM THÊM GIAO DỊCH -->
        <section id="transactionForm" class="card">
            <h2><i class="fas fa-plus-circle"></i> Thêm Giao Dịch Mới</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="date"><i class="far fa-calendar"></i> Ngày Giao Dịch:</label>
                    <input type="date" id="date">
                </div>
                <div class="form-group">
                    <label for="initialCapital"><i class="fas fa-dollar-sign"></i> Vốn Ban Đầu:</label>
                    <input type="number" id="initialCapital" step="0.01">
                </div>
                <div class="form-group">
                    <label for="finalBalance"><i class="fas fa-coins"></i> Số Dư Cuối:</label>
                    <input type="number" id="finalBalance" step="0.01" oninput="calculateProfitLoss()">
                </div>
            </div>
            <div class="form-actions">
                <button onclick="addTransaction()"><i class="fas fa-plus"></i> THÊM GIAO DỊCH</button>
                <button onclick="resetData()" class="reset-button"><i class="fas fa-trash-alt"></i> Reset Dữ Liệu</button>
            </div>
        </section>

        <!-- BẢNG GIAO DỊCH (ĐÃ ĐƯA LÊN TRÊN) -->
        <section id="transactionList" class="card">
            <h2><i class="fas fa-list-alt"></i> Chi Tiết Giao Dịch</h2>
            <table id="transactionTable">
                <thead>
                    <tr>
                        <th><i class="far fa-calendar-alt"></i> Date</th>
                        <th><i class="fas fa-dollar-sign"></i> Vốn</th>
                        <th><i class="fas fa-chart-bar"></i> PNL</th>
                        <th><i class="fas fa-percentage"></i> %</th>
                        <th><i class="fas fa-coins"></i> Số dư</th>
                        <th><i class="fas fa-trash"></i></th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dữ liệu sẽ được chèn vào đây bởi JavaScript -->
                </tbody>
            </table>
            <div id="pagination-controls">
                <button id="loadMoreBtn" onclick="loadMoreTransactions()" style="display: none;"><i class="fas fa-sync-alt"></i> Xem thêm 10 ngày giao dịch</button>
            </div>
        </section>

        <!-- TÓM TẮT & THỐNG KÊ (ĐÃ BỎ CHUỖI THẮNG/THUA) -->
        <section id="summary" class="card summary-grid">
            <h2><i class="fas fa-chart-pie"></i> Tóm Tắt & Thống Kê</h2>
            <div><i class="fas fa-calendar-check"></i>Tổng số ngày giao dịch: <span id="totalDays" class="summary-value">0</span> Ngày</div>
            <div><i class="fas fa-wallet"></i>Số dư cuối: <span id="finalBalanceSummary" class="summary-value">0.00 $</span></div>
            <div><i class="fas fa-arrow-up"></i> Tổng số tiền đã nạp: <span id="totalDeposits" class="summary-value positive">0.00 $</span></div>
            <div><i class="fas fa-arrow-down"></i> Tổng số tiền đã rút: <span id="totalWithdrawals" class="summary-value negative">0.00 $</span></div>
            <div><i class="fas fa-percentage"></i> Tỷ lệ Thắng/Thua: <span id="winLossRatio" class="summary-value">0.00% / 0.00%</span></div>
            <div><i class="fas fa-dollar-sign"></i> PNL Trung Bình: <span id="avgProfitLoss" class="summary-value">0.00 $</span></div>
            <div><i class="fas fa-chart-bar"></i>Tổng PNL (Lãi Ròng): <span id="totalProfitLoss" class="summary-value">0.00 $</span></div>
        </section>

        <!-- BIỂU ĐỒ TRỰC QUAN HÓA -->
        <section id="chartSection" class="card">
             <h2><i class="fas fa-chart-area"></i> Biểu Đồ PNL Theo Ngày</h2>
             <canvas id="pnlChart"></canvas>
        </section>

        <!-- CHỨC NĂNG EXCEL -->
        <section id="excelControls" class="card form-actions">
            <div class="export-group">
                <label for="exportMonth">Chọn tháng/năm để xuất:</label>
                <select id="exportMonth">
                    <option value="">Tất cả các tháng</option>
                    <option value="0">Tháng 1</option>
                    <option value="1">Tháng 2</option>
                    <option value="2">Tháng 3</option>
                    <option value="3">Tháng 4</option>
                    <option value="4">Tháng 5</option>
                    <option value="5">Tháng 6</option>
                    <option value="6">Tháng 7</option>
                    <option value="7">Tháng 8</option>
                    <option value="8">Tháng 9</option>
                    <option value="9">Tháng 10</option>
                    <option value="10">Tháng 11</option>
                    <option value="11">Tháng 12</option>
                </select>
                <input type="number" id="exportYear" placeholder="Năm (vd: 2024)">
                <button onclick="exportToExcelByMonth()"><i class="fas fa-file-excel"></i> Xuất Excel</button>
            </div>

            <div class="import-group">
                <label for="importFile"><i class="fas fa-upload"></i> Nhập file Excel:</label>
                <input type="file" id="importFile" accept=".xlsx, .xls">
                <button onclick="importFromExcel()"><i class="fas fa-file-import"></i> Nhập Excel</button>
            </div>
        </section>

        <p class="warning-note"><i class="far fa-times-circle"></i> Dữ liệu được lưu trên trình duyệt web, bạn sẽ mất dữ liệu nếu đổi trình duyệt hoặc xóa cache web! Hãy xuất Excel để sao lưu thường xuyên.</p>

        <center><a href="https://nofaw.com/apps/">
            <button class="call-to-action-btn">
                Tìm hiểu thêm <i class="fas fa-arrow-down"></i>
            </button>
        </a></center>
    </div>

    <!-- Script chính -->
    <script src="script.js"></script>
</body>

</html>
